{% extends 'base.html' %}
{% load thumbnail %}
{% load pagination_tags %}

{% block content %}
<div class="container">
  <div class="mt-3 mb-2 p-0">
    <span class="fw-bold fs-4 text-light">Топ пользователей</span>
  </div>

  <div class="mb-3 py-2 border-blue-100-bottom border-blue-100-top">
    {% if paginator.num_pages > 1 %}
    <div class="row g-3 fs-5">
      {% if page_obj.has_previous %}
      <div class="col-auto">
          <a class="link-light" href="?page={{ page_obj.number|add:'-1' }}"><</a>
      </div>
      {% endif %}
      {% for page in page_range %}
      <div class="col-auto">
        {% if page|is_number %}
        <a class="link-{% if page == page_obj.number %}orange-400{% else %}light{% endif %}" href="?page={{ page }}">{{ page }}</a>
        {% else %}
        <span class="text-light">{{ page }}</span>
        {% endif %}
      </div>
      {% endfor %}

      {% if page_obj.has_next %}
      <div class="col-auto">
        <a class="link-light" href="?page={{ page_obj.number|add:'1' }}">></a>
      </div>
      {% endif %}
    </div>
    {% endif %}
  </div>

  <div class="row g-3">
    {% for current_user in users %}
    <div class="col-lg-4 col-6">

      <div>

        <div>
          {% thumbnail current_user.profile.photo "500x100" crop="center" as im %}
          <img src="{{ im.url }}" class="rounded-top w-100">
          {% endthumbnail %}
        </div>

        <div class="p-3 bg-blue-800 rounded-bottom
        {% if request.GET.page == '1' or request.GET.page is None %}
        border-{% if forloop.counter == 1 %}yellow-300{% elif forloop.counter == 2 %}main-600{% elif forloop.counter == 3 %}main-400{% else %}blue-800{% endif %}-bottom
        {% endif %}">
          <a href="{{ current_user.get_absolute_url }}" class="link-light">
            <div class="border-blue-200-bottom pb-2">
                <span class="fw-bold">{{ current_user.username }}
                {% if user == current_user %}
                <small class="fw-light">(Вы)</small>
                {% endif %}
                </span>
            </div>

            <div class="pt-2 text-light">
              <div class="row row-cols-1 g-2">
                <div class="col">
                  Скорость печати: <span class="fw-bold">{{ current_user.statistics.wpm }}</span> WPM
                </div>
                <div class="col">
                  Аккуратность:
                  {% with current_user.statistics.accuracy as accuracy %}
                  <span class="
                  {% if 100 >= accuracy and accuracy > 75 %} text-green-300
                  {% elif 75 >= accuracy and accuracy > 50 %} text-orange-400
                  {% else %} text-red-300 {% endif %} fw-bold">
                  {{ accuracy }}
                  </span> %
                  {% endwith %}

                </div>
                <div class="col">
                  Количество попыток: <span class="fw-bold">{{ current_user.statistics.attempts_amount }}</span>
                  раз(а)
                </div>
              </div>
            </div>
          </a>

        </div>
      </div>

    </div>
    {% endfor %}
  </div>
</div>

{% endblock %}